# 二 总思路

将GUI的登录窗口独立出来，程序本身分为两个exe程序

- 反虚拟机沙箱；GUI登录界面，post发包界面；开机自启
- 主分发程序，截图，调用键盘记录，发送ftp服务。

每个程序调用的时候都需要引用固定的参数，用来防止反调试和沙箱。

远程的ftp服务要开匿名允许

# 功能实现

## 客户端

### 环境检查

通过检查`当前系统；磁盘大小；CPU的信息；网卡信息；Mac地址；能否通网；当前进程中是否存在虚拟机相关进程 `的检测手段判断是否在虚拟环境或者沙箱

通过判断init文件来判断是否需要重新登录窗口

检查当前目录dll和文化是否齐全，通过名称来检测

### 登录界面

利用C#的原生界面，通过对输入的姓名和学号进行格式判断，保存记录在authre.init文件中，同时通过post协议向远程的服务器发送身份验证包，并记录在日志中。

### 启动目录

通过设置启动目录实现开机自启

### 屏幕截图

利用api获得屏幕真实长宽，进行截图，只能截取主屏幕

### 键盘敲击记录

利用github上的现成的项目进行记录，目前只支持英文

### 本地打包

将截图进行异或混淆，然后和敲击记录组成7z包，再对7z包进行异或混淆。

统一存放再tmp目录下。

### 信息回传

每8分钟通过socket回传到服务器的12001端口，同时服务端进行监听

## 服务端

### 接收信息

监听80端口，客户端通过post发来的信息，并记录在log文件中

### 接收文件

监听本地的12001端口接收用户发来的文件，存放在同一个目录下，根据不同用户命名

### 解密文件

- 解密压缩包
- 根据密码解压
- 解密图片
- 根据发来的名称对压缩包和图片进行命名
- 如果文件名重复，就直接覆盖，只要最新的，创建备份目录，按照12345……的顺序备份过去，都存着

## 后端

### 获得文件

每8分钟服务端收获一批文件，所以后端监视就每10分钟从服务端拉取一次文件，新文件覆盖旧文件

- 通过一个可视化的文件管理，想看谁的看谁的，给后端一个权力。

# 问题

## 测试键盘记录

